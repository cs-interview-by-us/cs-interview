# 대칭키 & 공개키
## 정보 보호의 목표 5가지
### 기밀성 (Confidentiality)
- 오직 인가된 사람, 인가된 프로세스, 인가된 시스템이 알 필요성에 근거하여 시스템에 접근해야 한다는 원칙
- 위협요소
	- 도청, 사회공학
### 무결성 (Integrity)
- 정보의 내용이 불법적으로 생성 또는 변경되거나 삭제되지 않도록 보호되어야하는 성질
- 위협요소
	- 논리폭탄, 백도어, 바이러스
### 가용성 (Avaliability) 
- 정당한 사용자가 정보시스템의 데이터 또는 자원을 필요할 때 지체없이 원하는 객체 또는 자원에 접근하여 사용할 수 있는 성질
- 위협요소
	- Dos, DDos, 지진, 홍수, 화재
### 인증 (Authentication)
- 임의 정보에 접근할 수 있는 객체의 자격이나 객체의 내용을 검증하는데 사용되는 성질 
### 부인방지 (Non-repudiation)
- 행위나 이벤트의 발생을 증명하여 나중에 그런 행위나 이벤트를 부인할 수 없도록 하는 것 

## 대칭키
![대칭키](https://user-images.githubusercontent.com/31344894/199950505-187dbca0-4bbf-4b64-a783-8c7a16030851.png)
- ✨암호화와 복호화에 같은 암호키(대칭키)를 사용하는 알고리즘
- **기밀성**을 제공하나, **무결성/인증/부인방지를 보장하지 않습니다**. 
- 장점
	- 동일한 키를 주고받기 때문에, 매우 빠릅니다. 
- 단점
	- 대칭키 전달 과정에서 해킹 위험에 노출되어 있습니다. 
	- 대칭키 전달 과정에서 사람이 증가할수록 전부 따로따로 키교환을 해야하기 때문에 관리해야할 키가 방대하게 많아집니다. 
- 대표적인 알고리즘
	- SEED: 공인인증서의 암호화 방식
	- DES, 3DES, AES, ARIA, ChaCha20
## 공개키(비대칭키)
![](README/%E1%84%80%E1%85%A9%E1%86%BC%E1%84%80%E1%85%A2%E1%84%8F%E1%85%B5.png)
- 암호화와 복호화에 서로 다른 암호키를 사용하는 알고리즘 
- ✨전달할 내용을 상대방의 공개키로 암호화하고, 전달받은 내용은 자신의 비밀키로 복호화합니다. 
	- 공개키: 모든 사람이 접근 가능한 키
	- 비밀키: 각 사용자만이 가지고 있는 키
- 장점
	- 키분배가 필요하지 않습니다.
	- **기밀성/인증/부인방지 기능을 제공**합니다. 
- 단점
	- 복잡한 수학으로 이루어져있어 성능상 속도가 느립니다. 
- 방식
	- **암호 모드**
		- 송신자 공개키로 암호화 -> 송신자 비밀키로 복호화
		- 소량의 메세지 암호화 목적
		- 주로 키 교환의 용도로 사용합니다. 
	- **인증 모드**
		- 송신자 비밀키로 암호화 -> 송신자 공개키로 복호화
		- 메세지를 인증(부인방지)하는 것이 목적
- 대표적인 알고리즘
	- Diffie Hellman: 최초의 공개키 알고리즘 (위조에 취약)
	- RSA : 대표적 공개키 알고리즘
	* DSA : 전자서명 알고리즘 표준
	* ECC : 짧은 키로 높은 암호 강도, 빠른 구현 가능 PDA, 스마트폰등에 사용

## 하이브리드 방식 
### SSL
- ✨**대칭키와 공개키 암호화 방식을 적절히 혼합한 알고리즘**
- 웹서버와 브라우저 간의 통신을 암호화해서 중간에 누가 가로채더라도 내용을 알 수 없게 합니다.
- SSL이 적용되면 https:// 을 사용하여 웹서버에 접근하게 됩니다. 
	- SSL 프로토콜을 이용한 HTTPS 진행 
	- SSL != HTTPS
- **HTTPS 통신**에서 **실제 전송되는 데이터의 암호화에는 대칭키 암호화 방식을 사용**하고 **키 교환에는 비대칭키 암호화를 사용**합니다. 
	- 공개키 암호화의 느린 처리속도와 대칭키의 키 공유에서 생기는 문제점을 해결해줍니다. 
- SSL이 적용될 수 있는 Application Layer들은 HTTP, FTP, Telnet 등 여러가지가 있으며, 이 중 HTTP에 적용하여 사용하는 것을 HTTPS라고 부릅니다. 
![](README/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA%202022-11-04%20%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE%207.00.08.png)

### SSL 동작 방식
![](README/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA%202022-11-04%20%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE%206.59.03.png)
1. 클라이언트가 서버에 접속합니다. -> Client Hello 단계
2. 서버는 Client Hello에 대한 응답으로 Server Hello를 합니다. 
3. 클라이언트는 서버의 인증서가 CA에 의해서 발급된 것인지 확인하기 위해 클라이언트에 내장된 ✨CA 리스트를 확인합니다.
	- CA 리스트에 인증서가 없다면 사용자에게 경고 메세지를 출력합니다.
	- **인증서가 CA에 의해서 발급된 것인지를 확인하는 방법**
		- **클라이언트에 내장된 CA의 공개키를 이용해서 인증서를 복호화**합니다.
		- 복호화에 성공했다면 인증서는 CA의 개인키로 암호화된 문서임이 암시적으로 보증이 된 것입니다. 
	- 클라이언트는 2번 과정을 통해서 받은 서버의 랜덤 데이터와 클라이언트가 생성한 랜덤 데이터를 조합해 **pre master secret** 키를 생성합니다.
4. 서버로부터 받은 인증서 안에 들어있는 서버의 공개키를 사용하여 pre master key를 암호화한 뒤 서버로 전송합니다. 
5. 서버는 클라이언트가 전송한 pre master secret 값을 자신의 비밀키로 복호화합니다.
	- 서버와 클라이언트는 pre master secret 키를 공유하게 되었습니다. 
6. 서버와 클라이언트는 pre master secret 키를 가지고 master secret 값을 만들고, master secret 값을 이용하여 **session key를 생성**합니다. 
	- pre master key -> master key -> session key 
7.  session key를 이용하여 서버와 클라이언트는 데이터를 대칭키 방식으로 암호화한 뒤, 주고 받습니다. 
	- 세션키를 클라이언트와 서버가 모두 공유합니다.
8. 클라이언트와 서버는 핸드쉐이크 단계의 종료를 서로에게 알립니다. 

### SSL 동작 방식 요약
- 악수 -> 세션 -> 세션 종료
- 악수
	- SSL 인증서를 주고 받습니다. 
	- 공개키 방식으로 대칭키 값을 암호화해서 전송합니다.
- 전송
	- 실제로 서버와 클라이언트가 데이터를 주고 받는 단계입니다.
	- 정보를 상대방에게 전송하기 전 session key 값을 이용하여 대칭키 방식으로 암호화합니다.
- 세션 종료
	- 데이터 전송이 끝나면 SSL 통신이 끝났음을 서로에게 알려줍니다.
	- 통신에 사용한 대칭키인 session key를 폐기합니다. 

### 대칭키와 공개키를 조합해서 사용하는 이유
```
만약 공개키를 그대로 사용하면 많은 접속이 몰리는 서버는 매우 큰 비용을 지불해야합니다.
반면 대칭키는 키를 상대에게 전송해야하는데, 암호화가 되지 않은 인터넷을 통해 키를 전송하는 것은 위험하기 때문에 
속도는 느리지만 데이터를 안전하게 주고 받을 수 있는 공개키 방식으로 대칭키를 암호화하고
실제 데이터를 주고 받을 때는 대칭키를 이용해서 데이터를 주고 받습니다. 
```

## 참고
- [Network 대챙키와 공개키 SSL 동작방식 | Hoyeon](https://hoyeonkim795.github.io/posts/%EB%8C%80%EC%B9%AD%ED%82%A4-%EA%B3%B5%EA%B0%9C%ED%82%A4/)
- [SSL(TLS)에 대하여, 간단히 알아보는 대칭키/공개키](https://proni.tistory.com/entry/SSLTLS%EC%97%90-%EB%8C%80%ED%95%98%EC%97%AC-%EA%B0%84%EB%8B%A8%ED%9E%88-%EC%95%8C%EC%95%84%EB%B3%B4%EB%8A%94-%EB%8C%80%EC%B9%AD%ED%82%A4%EA%B3%B5%EA%B0%9C%ED%82%A4)